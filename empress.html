<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Interactive Tree - Empress</title>

  <!-- vendors -->
  <link rel="stylesheet" type="text/css" href="pages/empress/vendor/css/slick.grid.css">
  <link rel="stylesheet" type="text/css" href="pages/empress/vendor/css/jquery-ui-1.11.3.custom.css">
  <link rel="stylesheet" type="text/css" href="pages/empress/vendor/css/slick.grid.format.css">
  <script type="text/javascript" src="pages/empress/vendor/js/gl-matrix.min.js"></script>
  <script type="text/javascript" src="pages/empress/vendor/js/jquery-2.2.4.min.js"></script>
  <script type="text/javascript" src="pages/empress/vendor/js/jquery.event.drag-2.2.min.js"></script>
  <script type="text/javascript" src="pages/empress/vendor/js/slick.core.min.js"></script>
  <script type="text/javascript" src="pages/empress/vendor/js/slick.editors.min.js"></script>
  <script type="text/javascript" src="pages/empress/vendor/js/slick.formatters.min.js"></script>
  <script type="text/javascript" src="pages/empress/vendor/js/slick.grid.min.js"></script>
  <script type="text/javascript" src="pages/empress/vendor/js/parse.js"></script>

  <!-- static -->
  <link rel="stylesheet" type="text/css" href="pages/empress/css/tree.css">
  <script type="text/javascript" src="pages/empress/js/init_webgl.js"></script>
  <script type="text/javascript" src="pages/empress/js/initialize_empress.js"></script>
  <script type="text/javascript" src="pages/empress/js/mouse_events.js"></script>
  <script type="text/javascript" src="pages/empress/js/callbacks.js"></script>
  <script type="text/javascript" src="pages/empress/js/drawing_loop.js"></script>
  <script type="text/javascript" src="pages/empress/js/init_webpage.js"></script>
  <script type="text/javascript" src="pages/empress/js/tree.js"></script>
  <script type="text/javascript" src="pages/empress/js/wol_tree.js"></script>

  <script type="text/javascript">

    // global constants
    const ranks = ["kingdom", "phylum", "class", "order", "family", "genus", "species"];

    // window load
    window.addEventListener("load", function () {
      "use strict";

      // initialize interface
      document.querySelectorAll(".content").forEach(function(div) {
        div.classList.add("hidden");
      });

      ["tax-level", "collapse-level", "tips-find-level", "nodes-find-level"]
        .forEach(function(id) {
        const sel = document.getElementById(id);
        ranks.forEach(function(rank) {
          const opt = document.createElement("option");
          opt.text = rank;
          if (id === "collapse-level" && rank === "phylum") {
            opt.selected = "selected";
          }
          sel.add(opt);
        });
      });

      // collapsible
      document.querySelectorAll(".collapsible").forEach(function(btn) {
        btn.addEventListener("click", function() {
          this.classList.toggle("active");
          this.nextElementSibling.classList.toggle("hidden");
          document.getElementById("metadata-tabs").style.opacity =
            document.querySelector(".content:not(.hidden)") ? 1.0 : 0.5;
        });
      });

    });
  </script>

</head>

<body>
  <!-- The tree -->
  <div class="tree-container">
    <div class="container">
      <canvas class="tree-surface" , id="tree-surface">
        Your browser does not support HTML5
      </canvas>
      <div id="tip-label-container"></div>
      <div id="node-label-container"></div>
      <div class="square"></div>
      <div class="selected-tree-menu">
        <input id="collapse" type="button" value="collapse" onclick="selectedTreeCollapse()" />
      </div>
    </div>

    <!-- Metadata tabs -->
    <div id="metadata-tabs">

      <!-- Branch tab -->
      <button class="collapsible">Branches</button>
      <div class="content">
        <div>
          <label for="highlight-options">Color by...</label>
          <select id="highlight-options">
            <option value=0 disabled> -- select an option -- </option>
          </select>
        </div>
        <div>
          <label for="color-options">Choose Color Map</label>
          <select id="color-options">
            <option disabled> -- Sequential -- </option>
            <option value="viridis" color="red">viridis</option>
            <option value="Blues">Blue</option>
            <option value="Greens">Green</option>
            <option value="Reds">Red</option>
            <option value="BuGn">Blue to Green</option>
            <option value="cool">Blue to Purple</option>
            <option value="YlOrRd">Yellow to Red</option>
            <option value="hot">Hot</option>
            <option value="winter">Winter</option>
            <option disabled>-- Diverging --</option>
            <option value="seismic">Blue to Red</option>
            <option value=coolwarm>Cool to Warm</option>
            <option value="PRGn">Purple to Green</option>
          </select>
        </div>
        <div>
          <button onclick="userHighlightSelect()">Color Branches</button>
        </div>
      </div>

      <!-- Color Clades -->
      <button class="collapsible">Color Clades</button>
      <div class="content">
        <div>
          <label for="tax-level">Taxonomic Level...</label>
          <select id="tax-level">
            <option value=0 disabled> -- select an option -- </option>
          </select>
        </div>
        <div>
          <label for="clade-options">Color by...</label>
          <select id="clade-options">
            <option value=0 disabled> -- select an option -- </option>
            <option value=0>Default</option>
          </select>
        </div>
        <div>
          <label for="color-options-tax">Choose Color Map</label>
          <select id="color-options-tax">
            <option disabled> -- Sequential -- </option>
            <option value="viridis" color="red">viridis</option>
            <option value="Blues">Blue</option>
            <option value="Greens">Green</option>
            <option value="Reds">Red</option>
            <option value="BuGn">Blue to Green</option>
            <option value="cool">Blue to Purple</option>
            <option value="YlOrRd">Yellow to Red</option>
            <option value="hot">Hot</option>
            <option value="winter">Winter</option>
            <option disabled>-- Diverging --</option>
            <option value="seismic">Blue to Red</option>
            <option value=coolwarm>Cool to Warm</option>
            <option value="PRGn">Purple to Green</option>
          </select>
        </div>
        <div>
          <button onclick="userCladeColor()">Color Clades</button>
        </div>
      </div>

      <!-- Collapse -->
      <button class="collapsible">Auto-Collapse</button>
      <div class="content">
        <div>
          <input type="checkbox" id="collapse-cb" onmouseover="checkForOrig()" onclick="autoCollapseTree()" >
          <select id="collapse-level" disabled="true" onchange="autoCollapseTree()">
            <option value=0 disabled> -- select an option -- </option>
          </select>
        </div>
      </div>

      <!-- Taxonomy -->
      <button class="collapsible">Taxonomy</button>
      <div class="content">
        <!-- toggle NCBI / GTDB -->
        <div>
          <p>
          <input type="radio" id="ncbi" name="sys" value="n_" onclick="changeTaxSys()" checked>
          <label for="ncbi">NCBI</label>
          <input type="radio" id="gtdb" name="sys" value="g_" onclick="changeTaxSys()">
          <label for="gtdb">GTDB</label>
          </p>
        </div>
        <div>
          <input type="radio" id="cura" name="type" value="c_" onclick="changeTaxSys()" checked>
          <label for="cura">curated</label>
          <input type="radio" id="orig" name="type" value="o_" onclick="changeTaxSys()">
          <label for="orig">original</label>
        </div>
        <div>
          <p>
            Displays the 10 largest clades within the viewing window. Ties are broken randomly.
          </p>
        </div>
        <div>
          <input type="checkbox" id="tips" onclick="retriveTaxonNodes('t')">
          <label for="tips">Tips</label>
          <select id="tips-find-level" onchange="retriveTaxonNodes('c')" disabled="true">
              <option value=0 disabled> -- select an option -- </option>
          </select>
        </div>
        <div>
          <input type="checkbox" id="internal-nodes" onmouseover="checkForOrig()" onclick="retriveTaxonNodes('n')">
          <label for="internal-nodes">Nodes</label>
          <select id="nodes-find-level" onchange="retriveTaxonNodes('n')" disabled="true">
              <option value=0 disabled> -- select an option -- </option>
          </select>
        </div>
      </div>
  </div>

  <div class="hidden" id="hover-box">
    <table id="hover-table"></table>
  </div>

  <div class="metadata-container"></div>
  <div id="scrolltable"></div>

    <script type="text/javascript">
      // fields to extract from metadata, used in extractInfo()
      let field = {
        edgeFields: ["px", "py", "branch_color", "x", "y", "branch_color"],
        nodeFields: ["x", "y", "color"],
        triangleFields: ["cx", "cy", "color", "lx", "ly", "color", "rx", "ry", "color"]
      };

      // stores matrices, and buffers that webgl will uses
      let shaderProgram = {};
      let c_shaderProgram = {};

      // the complied vertex/fragment shaders
      let gl = {}; // webgl context - used to call webgl functions

      // stores info need to draw such as vertex data
      let drawingData = {
        isMouseDown: false,
        lastMouseX: null,
        lastMouseY: null,
        zoomAmount: 50,
        currentZoom: 0,
        maxZoom: 30,
        hoveredNode: [],
        coloredClades: [],
        selectTree: [],
        triangles: [],
        numBranches: 0
      };

      let numAttr = 0;
      let attrItem = {};
      let grid = {};
      let tipLabels = {};
      let nodeLabels = {};
      let labelPos = 0;
      let gridInfo = {
        initData: [],
        data: [],
        columns: [],
        options: {},
        grid: {}
      };

      const TRI_PER_ARC = 100;
      const ELEMENTS_PER_VERT = 5;
      const VERT_PER_TRI = 3;

      let numUserSelects = 0;
      const CLEAR_COLOR_HEX = "FFFFFF";
      const CLEAR_COLOR = 1;
      let camera = {};
      let shftPress = false;

      let showLabels = false;
      let taxonNodes = [];

      let highToLow = function (dataRow1, dataRow2) {
        return dataRow1[3] < dataRow2[3] ? 1 : -1;
      };
      let random = function(dataRow1, dataRow2) {
        return Math.round(Math.random()) > 0 ? 1 : -1;
      }
    </script>

    <script type="text/javascript">
      {
        initialize();
      }
    </script>

</body>

</html>
